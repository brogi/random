#!/bin/sh

# Prompt the user for AWS Access Key ID
read -p "Enter AWS Access Key ID: " AWS_ACCESS_KEY_ID

# Prompt the user for AWS Secret Access Key (input will be hidden)
read -s -p "Enter AWS Secret Access Key: " AWS_SECRET_ACCESS_KEY
echo

# Prompt the user for AWS Session Token (input will be hidden)
read -s -p "Enter AWS Session Token: " AWS_SESSION_TOKEN
echo

# Configure AWS CLI with the provided credentials
aws configure set aws_access_key_id "$AWS_ACCESS_KEY_ID"
aws configure set aws_secret_access_key "$AWS_SECRET_ACCESS_KEY"
aws configure set aws_session_token "$AWS_SESSION_TOKEN"

echo "AWS CLI has been configured successfully."

# Test the AWS CLI connectivity by getting caller identity
echo "Testing AWS CLI connectivity..."
aws sts get-caller-identity --output text

# Check the exit status of the previous command
if [ $? -eq 0 ]; then
    echo "AWS CLI is configured and connected successfully."
else
    echo "Failed to connect to AWS. Please check your credentials and network connectivity."
fi

Private Sub Worksheet_Change(ByVal Target As Range)
    ' Run only if a single cell is changed (avoids unnecessary looping)
    If Target.Cells.Count > 1 Then Exit Sub

    ' Call the DisplayImage function
    Application.Run "DisplayImage", Target
End Sub



Sub DisplayImage(Target As Range)
    Dim ws1 As Worksheet, ws2 As Worksheet
    Dim imgName As String
    Dim img As Shape
    Dim newImg As Shape
    Dim s As Shape
    Dim scaleFactor As Double
    
    ' Define worksheets
    Set ws1 = ThisWorkbook.Sheets("Sheet1") ' Target sheet
    Set ws2 = ThisWorkbook.Sheets("Sheet2") ' Sheet with images

    ' Get the text from the changed cell
    imgName = Target.Value

    ' Remove any existing images in the same cell before inserting a new one
    For Each s In ws1.Shapes
        If s.TopLeftCell.Address = Target.Address Then s.Delete
    Next s

    ' Attempt to find a matching image in Sheet2
    On Error Resume Next
    Set img = ws2.Shapes(imgName)
    On Error GoTo 0

    ' If image exists, duplicate and paste it into Sheet1
    If Not img Is Nothing Then
        img.Copy
        ws1.Paste
        
        ' Get the pasted image
        Set newImg = ws1.Shapes(ws1.Shapes.Count)

        ' Position & resize new image
        With newImg
            .LockAspectRatio = msoTrue ' Maintain proportions
            
            ' Calculate scale factor to fit inside cell
            scaleFactor = Application.Min((Target.Width * 0.9) / .Width, (Target.Height * 0.9) / .Height)
            .Width = .Width * scaleFactor
            .Height = .Height * scaleFactor

            ' Center image in the cell
            .Top = Target.Top + (Target.Height - .Height) / 2
            .Left = Target.Left + (Target.Width - .Width) / 2
            
            ' Assign a unique name to avoid conflicts
            .Name = "img_" & Target.Address
        End With
        
        ' Hide the text by changing font color to match background
        Target.Font.Color = Target.Interior.Color ' Makes text invisible
    End If
End Sub

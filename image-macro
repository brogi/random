Private Sub Worksheet_Change(ByVal Target As Range)
    ' Run only if a single cell is changed (avoids unnecessary looping)
    If Target.Cells.Count > 1 Then Exit Sub

    ' Call the DisplayImage function
    Application.Run "DisplayImage", Target
End Sub



Sub DisplayImage(Target As Range)
    Dim ws1 As Worksheet, ws2 As Worksheet
    Dim imgName As String
    Dim img As Shape
    Dim s As Shape
    
    ' Define worksheets
    Set ws1 = ThisWorkbook.Sheets("Sheet1") ' Where images will appear
    Set ws2 = ThisWorkbook.Sheets("Sheet2") ' Where images are stored

    ' Get the text from the changed cell
    imgName = Target.Value

    ' Remove any existing images in the same cell before inserting a new one
    For Each s In ws1.Shapes
        If s.TopLeftCell.Address = Target.Address Then s.Delete
    Next s

    ' Attempt to find a matching image in Sheet2
    On Error Resume Next
    Set img = ws2.Shapes(imgName)
    On Error GoTo 0

    ' If image exists, copy and paste it
    If Not img Is Nothing Then
        img.Copy
        ws1.Paste

        ' Center the image inside the cell
        With ws1.Shapes(ws1.Shapes.Count)
            .LockAspectRatio = msoTrue ' Maintain proportions
            
            ' Resize image to fit inside the cell (optional, adjust as needed)
            .Height = Target.Height * 0.9
            .Width = Target.Width * 0.9
            
            ' Center image in the cell
            .Top = Target.Top + (Target.Height - .Height) / 2
            .Left = Target.Left + (Target.Width - .Width) / 2
            
            ' Assign a unique name to avoid conflicts
            .Name = "img_" & Target.Address
        End With
    End If
End Sub
